@page
@model IndexModel
@{
    ViewData["Title"] = "Home page";
}

@section Header{
    <link href='~/lib/fullcalendar/core/main.css' rel='stylesheet' />
    <link href='~/lib/fullcalendar/daygrid/main.css' rel='stylesheet' />
    <link href='~/lib/fullcalendar/timegrid/main.css' rel='stylesheet' />

    <script src='~/lib/fullcalendar/core/main.js'></script>
    <script src='~/lib/fullcalendar/daygrid/main.js'></script>
    <script src='~/lib/fullcalendar/timegrid/main.js'></script>
    <script src='~/lib/fullcalendar/moment/main.js'></script>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            var calendarEl = document.getElementById('calendar');

            var calendar = new FullCalendar.Calendar(calendarEl, {
                plugins: ['timeGrid'],
                defaultView: 'timeGridWeek',
                locale: 'fr',
                contentHeight: "auto",
                height: "auto",
                firstDay: 1,
                allDaySlot: false,
                minTime: "08:00:00",
                maxTime: "21:00:00",
                weekends: false,
                nowIndicator: true
            });

            loadAll(calendar);
        });

        function loadAll(calendar) {
            var currentUrl = window.location.href;
            @foreach (var item in Model.Seances)
            {
                <text>
                    calendar.addEvent({
                        title: '@Html.Raw(@item.TitleFullCalendarFormat)',
                        start: '@item.StartDateFullCalendarFormat',
                        end: '@item.EndDateFullCalendarFormat',
                        @if (User.Identity.IsAuthenticated && User.IsInRole("Gestionnaire")) { <text> url: currentUrl + "Seances/Edit?id=" + @item.ID </text>}
                        });
                </text>
            }
            calendar.render();
        }

    </script>
}

<div class="text-center">
    <h1 class="display-4">Bienvenue, voici l'emploi du temps:</h1>
</div>
@if (User.Identity.IsAuthenticated && User.IsInRole("Gestionnaire"))
{
    <div class="alert alert-info col-8" role="alert">
        En tant que Gestionnaire vous pouvez cliquer sur une séance de l'emploi du temps pour editer les informations.
    </div>
}
<div id='calendar'></div>